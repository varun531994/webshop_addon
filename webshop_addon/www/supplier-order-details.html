{% extends "templates/web.html" %}

{% from "webshop/templates/includes/order/order_macros.html"
import item_name_and_description %}

{% block title %}
{{ _("Order") }} {{ doc.name }}
{% endblock %}

{# ---------------- HEADER ACTIONS ---------------- #}
{% block header_actions %}
<div class="row">
    <div class="dropdown">
        <button class="btn btn-sm btn-secondary dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
            <span class="font-md">{{ _('Actions') }}</span>
            <b class="caret"></b>
        </button>

        <ul class="dropdown-menu dropdown-menu-right" role="menu">
            <a class="dropdown-item" href="/printview?doctype={{ doc.doctype }}&name={{ doc.name }}" target="_blank"
                rel="noopener noreferrer">
                {{ _("Print") }}
            </a>
        </ul>
    </div>

    <div class="form-column col-sm-6 text-right">
        {% if doc.status == "To Deliver and Bill"%}
        <button type="button" class="btn btn-info btn-sm dispatch-btn" data-name="{{ doc.name }}">
            Dispatch
        </button>
        {% endif %}
    </div>
</div>
{% endblock %}

{# ---------------- PAGE CONTENT ---------------- #}
{% block page_content %}
<div>

    <div class="row transaction-subheading mt-1">
        <div class="col-6 text-muted small mt-1">
            {{ frappe.utils.format_date(doc.transaction_date, 'medium') }}
        </div>
    </div>

    <div class="row indicator-container mt-2">
        <div class="col-10">
            <span class="indicator-pill
				{{ doc.indicator_color or (" blue" if doc.docstatus==1 else "darkgrey" ) }}">
                {{ doc.status }}
            </span>
        </div>

        <div class="text-right col-2">
            <b>{{ doc.customer_name or doc.customer }}</b>
        </div>
    </div>

    {% if doc._header %}
    {{ doc._header }}
    {% endif %}

    <div class="order-container mt-4">

        {# -------- ITEMS -------- #}
        <div class="w-100">
            <div class="order-items order-item-header mb-1 row text-muted">
                <span class="col-5">{{ _("Item") }}</span>
                <span class="d-s-n col-3">{{ _("Quantity") }}</span>
                <span class="col-2">{{ _("Rate") }}</span>
                <span class="col-2 text-right">{{ _("Amount") }}</span>
            </div>

            {% for d in doc.items %}
            <div class="order-items row align-items-center">
                <span class="order-item-name col-5 pr-0">
                    {{ item_name_and_description(d) }}
                </span>

                <span class="d-s-n col-3">
                    {{ d.get_formatted("qty") }}
                </span>

                <span class="order-rate col-2">
                    {{ d.get_formatted("rate") }}
                </span>

                <span class="col-2 text-right">
                    {{ d.get_formatted("amount") }}
                </span>
            </div>
            {% endfor %}
        </div>

        {# -------- TAXES & TOTALS -------- #}
        {% include "webshop/templates/includes/order/order_taxes.html" %}

    </div>

    {# -------- ATTACHMENTS -------- #}
    {% if attachments %}
    <div class="order-item-table mt-4">
        <div class="row order-items order-item-header text-muted">
            <div class="col-sm-12 h6 text-uppercase">
                {{ _("Attachments") }}
            </div>
        </div>

        <div class="row order-items">
            <div class="col-sm-12">
                {% for attachment in attachments %}
                <p class="small">
                    <a href="{{ attachment.file_url }}" target="_blank">
                        {{ attachment.file_name }}
                    </a>
                </p>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    {# -------- TERMS -------- #}
    {% if doc.terms %}
    <div class="terms-and-condition text-muted small mt-4">
        <hr>
        <p>{{ doc.terms }}</p>
    </div>
    {% endif %}

</div>
{% endblock %}

{# ---------------- SCRIPTS ---------------- #}
{% block script %}
<script>
    window.doc_info = {
        doctype: "{{ doc.doctype }}",
        name: "{{ doc.name }}",
        grand_total: "{{ doc.grand_total }}",
        currency: "{{ doc.currency }}"
    }


</script>
    <script>
        {% include "templates/pages/cod_order_workflow.js" %}
    </script>
{% endblock %}